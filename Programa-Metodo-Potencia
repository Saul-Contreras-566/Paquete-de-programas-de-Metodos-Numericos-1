#include <stdio.h>
#include <stdlib.h>
#include <math.h>

#define MAX 20

// Función para calcular la norma infinito
double norma_infinito(double v[], int n){
    double max = fabs(v[0]);
    for(int i = 1; i < n; i++){
        if(fabs(v[i]) > max)
            max = fabs(v[i]);
    }
    return max;
}

// Multiplicación matriz–vector
void mult_mat_vec(double A[][MAX], double x[], double y[], int n){
    for(int i = 0; i < n; i++){
        y[i] = 0;
        for(int j = 0; j < n; j++){
            y[i] += A[i][j] * x[j];
        }
    }
}

int main(){
    double A[MAX][MAX], x[MAX], y[MAX];
    int n, iter;
    char otroSistema, otroVector;

    do{
        system("cls");
        printf("===== METODO DE POTENCIAS =====\n\n");

        // ================================
        // 1. Leer matriz del sistema
        // ================================
        printf("Ingrese la dimension de la matriz (n): ");
        scanf("%d", &n);

        if(n <= 1 || n > MAX){
            printf("Dimension invalida.\n");
            goto preguntar_otro_sistema;
        }

        printf("\nIngrese la matriz A (%dx%d):\n", n, n);
        for(int i = 0; i < n; i++)
            for(int j = 0; j < n; j++)
                scanf("%lf", &A[i][j]);

        // ================================
        // 2. Verificar si puede tener solución
        // (Aquí solo revisamos que no sea nula)
        // ================================
        int matrizNula = 1;
        for(int i = 0; i < n; i++)
            for(int j = 0; j < n; j++)
                if(A[i][j] != 0)
                    matrizNula = 0;

        if(matrizNula){
            printf("\nLa matriz es nula. No se puede aplicar el método.\n");
            goto preguntar_otro_sistema;
        }

        do{
            // ================================
            // 3. Leer vector solución inicial
            // ================================
            printf("\nIngrese el vector inicial x0 (%d valores):\n", n);
            for(int i = 0; i < n; i++)
                scanf("%lf", &x[i]);

            printf("\nNumero de iteraciones a realizar: ");
            scanf("%d", &iter);

            printf("\n=== Iteraciones ===\n");

            // ================================
            // 4. Iteraciones del método
            // ================================
            for(int k = 1; k <= iter; k++){
                // Multiplicación Ax
                mult_mat_vec(A, x, y, n);

                // Norma espectral aproximada
                double norma = norma_infinito(y, n);

                // Normalización
                for(int i = 0; i < n; i++)
                    x[i] = y[i] / norma;

                // Imprimir resultados de la iteración
                printf("Iteracion %d:\n", k);
                printf("Vector: [ ");
                for(int i = 0; i < n; i++)
                    printf("%.6lf ", x[i]);
                printf("]\nNorma espectral aprox: %.6lf\n\n", norma);
            }

            // ================================
            // Preguntar si quiere otro vector
            // ================================
            printf("\n¿Desea usar otro vector inicial con la MISMA matriz? (s/n): ");
            scanf(" %c", &otroVector);

        }while(otroVector == 's' || otroVector == 'S');

        // ================================
        // 5. Preguntar si quiere otro sistema
        // ================================
        preguntar_otro_sistema:
        printf("\n¿Desea resolver otro sistema con otra matriz? (s/n): ");
        scanf(" %c", &otroSistema);

    }while(otroSistema == 's' || otroSistema == 'S');

    printf("\nFin del programa.\n");
    return 0;
}
